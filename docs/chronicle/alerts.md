# Alert Management

The Chronicle client provides capabilities for managing and querying alerts generated by detection rules.

## Listing Alerts

You can list and filter alerts:

```python
from secops import SecOpsClient

# Initialize the client
client = SecOpsClient()
chronicle = client.chronicle(
    customer_id="your-chronicle-instance-id",
    project_id="your-project-id",
    region="us"
)

# List all alerts from the last 7 days
alerts = chronicle.list_alerts(
    start_time="7d"
)

# Process the results
for alert in alerts:
    print(f"Alert ID: {alert.get('id')}")
    print(f"Name: {alert.get('name')}")
    print(f"Severity: {alert.get('severity')}")
    print(f"Created: {alert.get('createTime')}")
    print("---")
```

## Filtering Alerts

You can filter alerts by various criteria:

```python
# Filter alerts by severity
high_severity_alerts = chronicle.list_alerts(
    start_time="7d",
    severity="HIGH"
)

# Filter alerts by detection rule
rule_alerts = chronicle.list_alerts(
    start_time="30d",
    rule_id="ru_12345678"
)

# Filter alerts by status
open_alerts = chronicle.list_alerts(
    start_time="30d",
    status="OPEN"
)
```

## Getting Alert Details

You can get detailed information about a specific alert:

```python
# Get details of a specific alert
alert_details = chronicle.get_alert(
    alert_id="al_12345678"
)

print(f"Alert ID: {alert_details.get('id')}")
print(f"Name: {alert_details.get('name')}")
print(f"Description: {alert_details.get('description')}")
print(f"Severity: {alert_details.get('severity')}")
print(f"Status: {alert_details.get('status')}")
print(f"Created: {alert_details.get('createTime')}")
print(f"Updated: {alert_details.get('updateTime')}")

# Get events associated with the alert
alert_events = alert_details.get('events', [])
for event in alert_events:
    print(f"Event time: {event.get('metadata', {}).get('event_timestamp')}")
    print(f"Product: {event.get('metadata', {}).get('product_name')}")
    print("---")
```

## Updating Alert Status

You can update the status of an alert:

```python
# Update alert status to CLOSED
update_result = chronicle.update_alert_status(
    alert_id="al_12345678",
    status="CLOSED",
    comment="False positive - known behavior"
)

print(f"Updated: {update_result.get('success')}")
```

## Alert Statuses

Chronicle supports the following alert statuses:

| Status | Description |
|--------|-------------|
| `OPEN` | Alert is open and requires investigation |
| `IN_PROGRESS` | Alert is being investigated |
| `CLOSED` | Alert investigation is complete |
| `SUPPRESSED` | Alert is suppressed and not shown in default views |

## Alert Severities

Chronicle supports the following alert severities:

| Severity | Description |
|----------|-------------|
| `CRITICAL` | Highest severity, requires immediate attention |
| `HIGH` | High severity, requires prompt attention |
| `MEDIUM` | Medium severity, should be investigated |
| `LOW` | Low severity, may be investigated as resources allow |
| `INFORMATIONAL` | Informational only, no immediate action required |

## Bulk Alert Updates

You can update multiple alerts at once:

```python
# Update multiple alerts to CLOSED
alert_ids = ["al_12345678", "al_87654321"]
bulk_update = chronicle.bulk_update_alert_status(
    alert_ids=alert_ids,
    status="CLOSED",
    comment="Resolved during maintenance window"
)

print(f"Updated count: {bulk_update.get('successCount')}")
if bulk_update.get('failureCount') > 0:
    print(f"Failed count: {bulk_update.get('failureCount')}")
    for failure in bulk_update.get('failures', []):
        print(f"Failed alert: {failure.get('alertId')}")
        print(f"Reason: {failure.get('reason')}")
```

## Time Formats

The Alert API supports multiple time formats:

- **Relative time**: `"1h"`, `"6h"`, `"1d"`, `"7d"`, `"30d"`
- **ISO 8601**: `"2023-01-01T00:00:00Z"`
- **RFC 3339**: `"2023-01-01T00:00:00+00:00"`

## Pagination

For large result sets, use pagination:

```python
# First page
results = chronicle.list_alerts(
    start_time="30d",
    page_size=25
)

# Get next page if there are more results
if results.next_page_token:
    next_page = chronicle.list_alerts(
        start_time="30d",
        page_size=25,
        page_token=results.next_page_token
    )
```

## Error Handling

```python
try:
    alert_details = chronicle.get_alert(
        alert_id="al_12345678"
    )
except Exception as e:
    print(f"Alert lookup failed: {e}")
```
